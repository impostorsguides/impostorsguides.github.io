<header class="post-header">
  <h1 class="post-title">Installing (or re-installing) RBENV</h1>
</header>

<div w3-include-html="install-rbenv-title.html"></div>

<p>As we previously mentioned, the first step is to install RBENV on your machine.  I'm writing this tutorial on a Macbook running macOS, and I'll be using macOS-specific installation instructions and commands throughout.</p>

<p><strong>Even if you're already an RBENV user</strong>, you'll want to read this chapter, since there's a good chance you'll need to re-install RBENV from source (as opposed to via Homebrew or similar).</p>

<h2>Ensuring you have no other version managers installed</h2>

<p>Admittedly, the best candidates for reading this book are people who already use RBENV as their Ruby version manager.  As you'll soon see, users of other version managers (such as rvm, asdf, chruby, etc.) will face more and bigger hurdles than users of RBENV (more on why in a minute).</p>

<p>With that in mind, we'll need to make sure you don't have a different Ruby version manager installed, such as RVM.  If you do, that will represent a blocker to your continuing this guide, since you'll have different version managers competing to manage your Ruby version.  This could introduce <a href="https://web.archive.org/web/20160715135727/https://stackoverflow.com/questions/35808103/rvm-and-rbenv-on-the-same-machine" target="_blank" rel="noopener">unexpected behavior</a> and negatively impact your usage of Ruby.</p>

<p>We can check for the most popular Ruby version managers by using the <code>which</code> command:</p>

<pre><code>$ which asdf
asdf not found
$ which rvm
rvm not found
$ which chruby
chruby not found
$ </code></pre>

<p>If you see anything other than "not found" for <code>which asdf</code>, <code>which rvm</code>, and <code>which chruby</code>, you likely have another version manager on your machine.  In that case, you'll need to make a decision about which version manager you want to use.  <a href="https://github.com/rbenv/rbenv/wiki/Comparison-of-version-managers" target='_blank' rel='noopener'>RBENV's Github page has a guide</a> on differentiating between the various version managers out there.</p>

<p>If you don't have other version managers on your machine, feel free to move on to the next section.</p>

<h2>Making sure RBENV is installed correctly</h2>

<p>Installing RBENV via <code>brew install rbenv</code> would be a perfectly fine option for a normal user.  But it won't work for our purposes, because it would leave us without access to RBENV's <code>.git</code> directory, and therefore its git history.  That means we couldn't roll back to the specific version of RBENV that I'll be using for this walk-through.  It's important that we work off the same codebase, so let's try another technique- installing from source.</p>

<p>To do this, we'll follow the instructions on <a href='https://github.com/rbenv/rbenv/tree/e8b7a27ee67a5751b899215b4d35fd86ab552dae#basic-git-checkout' target='_blank' rel='noopener'>this version of the RBENV Readme file</a>.  First, open your terminal and check whether you already have a directory called <code>~/.rbenv</code>, by running <code>ls -la ~/.rbenv</code>:</p>

<pre><code>$ ls -la ~/.rbenv
total 80
drwxr-xr-x  18 root          staff    576 Jan  9 14:11 .
drwxr-x---+ 36 richiethomas  staff   1152 Jan 10 12:23 ..
drwxr-xr-x  13 root          staff    416 Jan  9 14:11 .git
drwxr-xr-x   3 root          staff     96 Jan  9 14:11 .github
-rw-r--r--   1 root          staff     97 Jan  9 14:10 .gitignore
-rw-r--r--   1 root          staff     35 Jan  9 14:10 .vimrc
-rw-r--r--   1 root          staff   3390 Jan  9 14:10 CODE_OF_CONDUCT.md
-rw-r--r--   1 root          staff   1058 Jan  9 14:10 LICENSE
-rw-r--r--   1 root          staff  18411 Jan  9 14:11 README.md
drwxr-xr-x   3 root          staff     96 Jan  9 14:10 bin
drwxr-xr-x   4 root          staff    128 Jan  9 14:11 completions
drwxr-xr-x  27 root          staff    864 Jan  9 14:11 libexec
drwxr-xr-x   3 root          staff     96 Dec 23 11:37 rbenv.d
drwxr-xr-x  39 root          staff   1248 Jan  9 14:35 shims
drwxr-xr-x   7 root          staff    224 Jan  9 14:11 src
drwxr-xr-x  28 root          staff    896 Jan  9 14:11 test
-rw-r--r--   1 root          staff      6 Dec 23 11:38 version
drwxr-xr-x   5 root          staff    160 Dec 23 11:38 versions
$ </code></pre>

<p>If this directory does exist, <strong>and</strong> if the command output includes a <code>.git/</code> directory in it like it does above, you should be good to go.</p>

<p>Another possibility is that the output exists but looks like this:</p>

<pre><code>$ ls -la ~/.rbenv
total 8
drwxr-xr-x   5 richiethomas  staff   160 Jan 10 12:56 .
drwxr-x---+ 37 richiethomas  staff  1184 Jan 10 12:56 ..
drwxr-xr-x  15 richiethomas  staff   480 Jan 10 12:56 shims
-rw-r--r--   1 richiethomas  staff     6 Jan 10 12:57 version
drwxr-xr-x   3 richiethomas  staff    96 Jan 10 12:48 versions
$ </code></pre>

<p>Specifically, you run the <code>ls -la</code> command and you don't see a <code>.git</code> folder included in the output.</p>

<p>That likely means you previously installed RBENV using a package manager like Homebrew.  If this is the case, one option is to simply rename your <code>/.rbenv</code> directory as <code>/.rbenv-old</code> or something similar:</p>

<pre><code>$ mv ~/.rbenv/ ~/.rbenv-old</code></pre>

<p>If you get a <code>Permission denied</code> error, you may need to add <code>sudo</code> to the front of the above command (and enter your password when prompted) in order to rename the folder:</p>

<pre><code>$ sudo mv ~/.rbenv/ ~/.rbenv-old
Password:
$ </code></pre>

<p>After the old RBENV folder is renamed, we can install RBENV again via source, by following the instructions on <a href='https://github.com/rbenv/rbenv/tree/e8b7a27ee67a5751b899215b4d35fd86ab552dae#basic-git-checkout' target='_blank' rel='noopener'>this version of the RBENV Readme file</a>.  Run the following command:</p>

<pre><code>$ git clone https://github.com/rbenv/rbenv.git ~/.rbenv
Cloning into '/Users/richiethomas/.rbenv'...
remote: Enumerating objects: 3270, done.
remote: Counting objects: 100% (420/420), done.
remote: Compressing objects: 100% (218/218), done.
remote: Total 3270 (delta 234), reused 327 (delta 188), pack-reused 2850
Receiving objects: 100% (3270/3270), 662.28 KiB | 258.00 KiB/s, done.
Resolving deltas: 100% (2024/2024), done.
$ </code></pre>


<p>Once this is done, you should have a fresh installation of RBENV inside <code>~/.rbenv</code>, which includes a <code>.git</code> directory:</p>

<pre><code>$ ls -la ~/.rbenv
total 80
drwxr-xr-x  18 richiethomas  staff    576 Jan 10 13:03 .
drwxr-x---+ 37 richiethomas  staff   1184 Jan 10 13:03 ..
drwxr-xr-x  12 richiethomas  staff    384 Jan 10 13:03 .git
-rw-r--r--   1 richiethomas  staff     47 Jan 10 13:03 .gitattributes
drwxr-xr-x   4 richiethomas  staff    128 Jan 10 13:03 .github
-rw-r--r--   1 richiethomas  staff     97 Jan 10 13:03 .gitignore
-rw-r--r--   1 richiethomas  staff     35 Jan 10 13:03 .vimrc
-rw-r--r--   1 richiethomas  staff   3390 Jan 10 13:03 CODE_OF_CONDUCT.md
-rw-r--r--   1 richiethomas  staff   1058 Jan 10 13:03 LICENSE
-rw-r--r--   1 richiethomas  staff    163 Jan 10 13:03 Makefile
-rw-r--r--   1 richiethomas  staff  12636 Jan 10 13:03 README.md
drwxr-xr-x   3 richiethomas  staff     96 Jan 10 13:03 bin
drwxr-xr-x   4 richiethomas  staff    128 Jan 10 13:03 completions
drwxr-xr-x  27 richiethomas  staff    864 Jan 10 13:03 libexec
drwxr-xr-x   3 richiethomas  staff     96 Jan 10 13:03 rbenv.d
drwxr-xr-x   3 richiethomas  staff     96 Jan 10 13:03 share
drwxr-xr-x   4 richiethomas  staff    128 Jan 10 13:03 src
drwxr-xr-x  28 richiethomas  staff    896 Jan 10 13:03 test
$ </code></pre>

<h2>Ensuring your new RBENV install has your old data</h2>

<p>Next, we'll copy your currently-installed Ruby versions, gems, etc. to this new installation, ensuring that you can continue using RBENV as you have up until now:</p>

<pre><code>$ sudo cp -r ~/.rbenv-old/versions \                                                                                     
> ~/.rbenv-old/version \                                                                        
> ~/.rbenv-old/shims \                                                     
> ~/.rbenv-old/rbenv.d \                                
> ~/.rbenv-old/completions \       
> ~/.rbenv
$ </code></pre>


<p>Now, the version of RBENV which you installed from source should have any and all gems, installed Ruby versions, selected Ruby version, completions, and hooks that you may have previously installed in your old RBENV version.</p>

<p>If you ever encounter version-related problems with Ruby or RBENV on your machine from now on, you can simply delete the version of RBENV that we just installed, and rename your <code>~/.rbenv-old</code> directory back to <code>~/.rbenv</code>, and you should be good-to-go.</p>

<h2>Rolling back to the correct git commit</h2>

<p>Next, let's navigate into this directory via <code>cd ~/.rbenv</code>.</p>

<p>We want to make sure that we're all looking at the same code, which means looking at the same git commit.  So we'll create a new branch, separate from your <code>master</code> or <code>main</code> branch, and point that branch to a specific commit, i.e. the one that I used when I started writing this guide (that commit SHA is <code>c4395e58201966d9f90c12bd6b7342e389e7a4cb</code>).</p>

<p>I called my new branch <code>impostorsguides</code>, but you can call it whatever is easiest for you to remember:</p>

<pre><code>$ git checkout -b impostorsguides
Switched to a new branch 'impostorsguides'
~/.rbenv (impostorsguides)  $ git reset --hard c4395e58201966d9f90c12bd6b7342e389e7a4cb
HEAD is now at c4395e5 Merge pull request #1418 from uraitakahito/patch-0
$ </code></pre>

<p>For future reference, the Github link to this specific version of the RBENV codebase can be found <a href='https://github.com/rbenv/rbenv/tree/c4395e58201966d9f90c12bd6b7342e389e7a4cb' target='_blank' rel='noopener'>here</a>.</p>

<h2>Enabling RBENV's shell function</h2>

<p>We're getting close to the end, but we still have 2 more steps in <a href='https://github.com/rbenv/rbenv/tree/e8b7a27ee67a5751b899215b4d35fd86ab552dae#basic-git-checkout' target='_blank' rel='noopener'>the installation instructions</a>.  Next we have to add some text to our shell's startup script.  This script will create a shell function called <code>rbenv</code>, which (for our purposes) will do the same job as if we were running the command from a file.</p>

<p>The RBENV Readme file tells you how to add the text to your script.  The command you'll copy/paste into your terminal depends on which shell program (bash, zsh, etc.) you're running:</p>

<blockquote>
2. Configure your shell to load rbenv:

For <strong>bash</strong>:

Ubuntu Desktop users should configure <code>~/.bashrc</code>:

<pre><code>echo 'eval "$(~/.rbenv/bin/rbenv init - bash)"' >> ~/.bashrc</code></pre>

On other platforms, bash is usually configured via ~/.bash_profile:

<pre><code>echo 'eval "$(~/.rbenv/bin/rbenv init - bash)"' >> ~/.bash_profile</code></pre>

For <strong>Zsh</strong>:

<pre><code>echo 'eval "$(~/.rbenv/bin/rbenv init - zsh)"' >> ~/.zshrc</code></pre>

For <strong>Fish shell</strong>:

<pre><code>echo 'status --is-interactive; and ~/.rbenv/bin/rbenv init - fish | source' >> ~/.config/fish/config.fish</code></pre>

</blockquote>

<p>To find out which shell you're running, run the following command:</p>

<pre><code>$ echo $SHELL</code></pre>

<p>In my case, since I'm on a new Mac, my default terminal is Zsh:</p>

<pre><code>$ echo $SHELL
/bin/zsh
$</code></pre>

<p>Therefore, I'd paste the following into my terminal:</p>

<pre><code>$ echo 'eval "$(~/.rbenv/bin/rbenv init - zsh)"' >> ~/.zshrc</code></pre>

<p>This will add the text <code>eval "$(~/.rbenv/bin/rbenv init - zsh)"</code> into a file called <code>~/.zshrc</code>, which is run every time I open a new terminal tab.  If your terminal is different from mine (for example, <code>bash</code>), the filename will be different from <code>~/.zshrc</code> (for example, <code>~/.bashrc</code>), but the gist of what's happening is still the same.</p>

<p>Lastly, in order for these changes to take effect, I'll need to do exactly that- open a new terminal tab.  When I do so, and I run <code>which rbenv</code>, I see the following shell command definition:</p>

<pre><code>$ which rbenv
rbenv () {
  local command
  command="${1:-}" 
  if [ "$#" -gt 0 ]
  then
    shift
  fi
  case "$command" in
    (rehash | shell) eval "$(rbenv "sh-$command" "$@")" ;;
    (*) command rbenv "$command" "$@" ;;
  esac
}
$</code></pre>

<p>If we see the above output, we know RBENV has been successfully installed.</p>

<h2>What is an <code>rc</code> dotfile?</h2>

<p>When you open a new terminal tab or window in Zsh, one of the first things that happens is that Zsh runs a few setup scripts. One of these scripts is located at <code>.zshrc</code>. This file is where you'd put configuration options that you'd want to run on every new terminal tab or window.</p>

<p>There are other setup scripts which get loaded as well, such as <code>~/.zshenv</code>.  But <code>~/.zshrc</code> is the one I interact with most.  Zsh will run these scripts in a specific order, and there are <a href="https://web.archive.org/web/20230724164024/https://unix.stackexchange.com/questions/71253/what-should-shouldnt-go-in-zshenv-zshrc-zlogin-zprofile-zlogout" target="_blank">conventions around what you should put in each file</a>.</p>

<p>Other shells have similar <code>rc</code> files (ex.- Bash has <code>~/.bashrc</code>). The <code>rc</code> in <code>.zshrc</code> stands for "run commands" or "run control", depending on <a href="https://web.archive.org/web/20230320050723/https://unix.stackexchange.com/questions/3467/what-does-rc-in-bashrc-stand-for" target="_blank">who you ask</a>.</p>

<h2>Summary</h2>

<p>Now that we've installed RBENV and are pointing to the right version, let's move on.</p>
